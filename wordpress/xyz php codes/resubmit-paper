<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Paper Submission Form</title>
</head>
<body>
    <h2>Research Paper Submission</h2>
    <form action="/wordpress/custom-code/resubmitform.php" method="post" enctype="multipart/form-data">
        <?php
        $servername = "127.0.0.1";
        $username = "admin";
        $password = "Sanchit@123";
        $database = "Indiacom";
        $port = 8889;

        try {
            // Create connection
            $conn = new PDO("mysql:host=$servername;port=$port;dbname=$database", $username, $password);
            // Set the PDO error mode to exception
            $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            // Get the current user's ID - Assuming you obtain it through some other means
            $current_user_id = get_current_user_id(); // WordPress function to get current user's ID

            // Query to fetch paper IDs generated by the current user
            $query = "SELECT paper_id FROM researchpaper WHERE mid = :current_user_id";
            $stmt = $conn->prepare($query);
            $stmt->bindParam(':current_user_id', $current_user_id, PDO::PARAM_INT);
            $stmt->execute();

            // Check if there are any results
            if ($stmt->rowCount() > 0) {
                // Output select box with options
                echo '<label for="paper_id">Select Paper ID: *</label><br>';
                echo '<select id="paper_id" name="paper_id" required>';
                while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                    echo '<option value="' . $row['paper_id'] . '">' . $row['paper_id'] . '</option>';
                }
                echo '</select><br><br>';
            } else {
                echo '<p>No papers found for the current user.</p>';
            }
        } catch(PDOException $e) {
            echo "Connection failed: " . $e->getMessage();
        }
        ?>

        <label for="revised_paper">Upload Revised Paper (PDF, DOC, DOCX): *</label><br>
        <input type="file" id="revised_paper" name="revised_paper" accept=".pdf,.doc,.docx" required><br><br>

        <label for="plag_report">Upload Plagiarism Report (PDF only):</label><br>
        <input type="file" id="plag_report" name="plag_report" accept=".pdf"><br><br>

        <label for="ppt">Upload Presentation (PPT, PPTX):</label><br>
        <input type="file" id="ppt" name="ppt" accept=".ppt,.pptx"><br><br>

        <input type="submit" value="update">
    </form>
</body>
</html>